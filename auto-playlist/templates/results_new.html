{% extends 'base.html' %} 
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
{% endblock%}

{% block content %}
<div class="container-fluid" style="background-color:#8ec07c;">
    <div class="row align-items-center p-1">
        <div class="col-12 text-xs-center text-sm-left">
            <h2 class="m-2 tx-xs-center text-sm-left text-white">Your personalised <em>Sortify</em> is ready</h2>
        </div>
    </div>
</div>


<div class="container-fluid mt-4">
    <div class="w3-cell w3-container w3-responsive w3-center w3-margin-bottom" style="max-width: 1000px;">
        <div class="w3-light-gray w3-padding w3-medium w3-round-xlarge">
            <b>The results are in!</b> <br> We looked at 31 different attributes for each song you gave us. <br> <br> It looks like it makes sense to split your songs into {{ no_clusters }} playlists. <br> <br> Before we dive into the playlists, here's
            some general stats about your music taste. <br> <br> Your favourite genre is: <br> X, Y, and Z seem to be your favourite artists
            <div style="min-height:500px;">
          <canvas id="myChart1"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="border-top ml-0 mr-0 mt-3 mb-3 container-fluid"></div>

{% for numb, playlist in ai_playlists.items() %}
<div class="card mb-4">
    <div class="card-header">
        <div class="row justify-content-center">
            <div class="col-sm-5 align-self-center">
                <button type="button" class="btn btn-link container-fluid text-left" data-toggle="collapse" data-target="#numb{{ numb }}" aria-controls="numb{{ numb }}" aria-expanded="false" style="max-width:600px">
                        AI Playlist: {{ numb }}
                </button>
            </div>
            <div class="col-sm-5 align-self-center">
                {{ playlist['description']['no_tracks'] }} songs
            </div>
            <div class="col-sm-2 align-self-center">
                <div data-toggle="buttons">
                    <label class="btn" name="saveplaylists" type="button">
                        <input id="test" value="test" type="checkbox" data-toggle="button" name="saveplaylists" style="display:none;" autocomplete="off">
                        Include
                    </label>
                </div>
            </div>
        </div>
    </div>

   <!-- <label class="btn container-fluid p-0 m-1" name="checks" type="button">
        <input id="{{ playlist['playlist_uri'] }}" value="{{ playlist['playlist_uri'] }}" type="checkbox"
            data-toggle="button" name="checks" style="display: none;" autocomplete="off"> -->





    <div id="numb{{ numb }}" class="collapse">
        <div class="card-body">
            <!-- INSERT playlist analytics here -->
            <ul class="list-group border rounded" style="max-height:600px; overflow:auto;">
                {% for song in playlist['songs'] %}
                <li class="list-group-item">
                    <div class="row justify-content-center text-center text-md-left">
                        <div class="col-sm-4 col-md-2 align-self-center p-1">
                            <img src="{{ song['img'] }}" alt="Playlist Image" class="rounded img-fluid"
                                style="width: 30px;height: 30px;">
                        </div>
                        <div class="col-sm-8 col-md-4 align-self-center p-1 text-dark">
                            {{ song['track_name'] }} - {{ song['artist_name']}}
                        </div>
                        <div>
                            <audio src="{{ song['preview_url'] }}" id="{{ song['preview_url'] }}" preload="none" onplay="pauseOthers(this);"></audio>
                            <i class="fas fa-volume-up" id="{{ song['preview_url'] }}-btn" onclick="playPause('{{ song['preview_url'] }}', this)" aria-hidden="true" style="cursor:pointer;"></i>
                        </div>

                    </div>
                </li>
                {% endfor %}
            </ul>

        </div>
    </div>
</div>
{% endfor %}



<script>
    $('[data-toggle="buttons"] .btn').on('click', function() {
        // toggle style
        $(this).toggleClass('btn-grey active');

        // toggle checkbox
        var $chk = $(this).find('[type=checkbox]');
        $chk.prop('checked', !$chk.prop('checked'));

        return false;
    });

    /*$('form').on('submit', function(e) {
        // watch form values
        $('#formValues').html(($('form').serialize()));
        e.preventDefault();
    }); */
</script>


<script>
    function pauseOthers(ele) {
        $("audio").not(ele).each(function (index, audio) {
            audio.pause();
        });
    }
    
var ctx1 = document.getElementById('myChart1').getContext('2d');
var scatterChart1 = new Chart(ctx1, {
  type: 'scatter',
  data: {
    labels: {
          {% for numb, cluster in chart_data.items() %}
    '{{ numb }}':
        [{% for track in cluster %}
        '{{ track['track_name'] }} by {{track['artist_name']}}',
      {% endfor %} ],
      {% endfor %}
    },
    datasets: [
        
        {% for numb, cluster in chart_data.items() %}
            {label: '{{ numb }}',
            backgroundColor: '{{ cluster[0]['backgroundColor'] }}',
            pointStyle: '{{ cluster[0]['pointStyle'] }}',
            pointHoverRadius: 8,
            pointHitRadius: 4,
            pointRadius:4,
            data: [
                {% for track in cluster %}
                {
                 x: {{ track['PCA_1'] }},
                 y: {{ track['PCA_2'] }}
                },
                {% endfor %}
            ]},
        {% endfor %}
        ]},
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      xAxes: [{
        type: 'linear',
        position: 'bottom',
        gridLines: {display:true, drawBorder:true, drawOnChartArea:false, drawTicks:false},
        ticks: {padding: 8},
        scaleLabel: {display:true, labelString:'Principle Component 1'}
      }],
      yAxes: [{
          type: 'linear',
          position: 'left',
          gridLines: {display:true, drawBorder:true, drawOnChartArea:false, drawTicks:false},
          ticks: {padding: 8},
          scaleLabel: {display:true, labelString:'Principle Component 2'}
      }]
    },
    title: {display: true, text: '2-Dimensional Visualiation of your Library'},
        legend: {display:true, position: 'top', labels: {usePointStyle:true}},
            
    tooltips: {
        callbacks: {
            label: function(tooltipItem, data) {
                var label = data.labels[tooltipItem.datasetIndex][tooltipItem.index];
                return label
            },
        },
        backgroundColor: 'rgba(255,255,255,1)',
        bodyFontColor: 'rgba(150,150,150,1)',
        displayColors: false,
    },
  }
});
</script>

{% endblock %}
