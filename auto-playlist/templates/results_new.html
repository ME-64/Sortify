{% extends 'base.html' %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
{% endblock%}

{% block content %}
<div class="container-fluid" style="background-color:#8ec07c;">
    <div class="row align-items-center p-1">
        <div class="col-12 text-xs-center text-sm-left">
            <h2 class="m-2 tx-xs-center text-sm-left text-white">Your personalised <em>Sortify</em> is ready</h2>
        </div>
    </div>
</div>


<div class="container-fluid mt-4">
    <div class="w3-cell w3-container w3-responsive w3-center w3-margin-bottom" style="max-width: 1000px;">
        <div class="w3-light-gray w3-padding w3-medium w3-round-xlarge">
            <b>The results are in!</b> <br> We looked at 31 different attributes for each song you gave us. <br> <br> It
            looks like it makes sense to split your songs into {{ no_clusters }} playlists. <br> <br> Before we dive
            into the playlists, here's
            some general stats about your music taste. <br> <br> Your favourite genre is: <br> X, Y, and Z seem to be
            your favourite artists
            <!-- <div style="min-height:500px;"> -->
            <!--     <canvas id="myChart1"></canvas> -->
            <!-- </div> -->
        </div>
    </div>
</div>

<div class="border-top ml-0 mr-0 mt-3 mb-3 container-fluid align-content-center"></div>

{% for numb, playlist in ai_playlists.items() %}
<div class="card mb-1 border-0 mx-auto" style="max-width: 600px;">
    <div class="card-header p-4 m-4 border-0" style="max-width: 600px;">
        <div class="row justify-content-center align-self-center">
            <div class="col-sm-3 align-self-center">
                <img src="{{ playlist['description']['img'] }}" alt="playlistimg" width="64px" height="64px" class="rounded"/>
            </div>
            <div class="col-sm-7 align-self-center justify-content-start">
                <button type="button" class="btn btn-lg container text-left display-3" data-toggle="collapse"
                    data-target="#numb{{ numb }}" aria-controls="numb{{ numb }}" aria-expanded="false"
                    style="max-width:800px; vertical-align:middle;">
                <!-- <i class="fas fa-caret-down fa-3x text-secondary text-center mr-1"></i> -->
                <span class="text-primary align-text-middle align-middle"> {{ playlist['description']['name'] }} </span>
                </button>
            </div>
            <div class="col-sm-2 align-self-center">
                <div data-toggle="buttons">
                    <label class="btn" name="saveplaylists" type="button">
                        <input id="test" value="test" type="checkbox" data-toggle="button" name="saveplaylists"
                            style="display:none;" autocomplete="off">
                        Include
                    </label>
                </div>
            </div>
        </div>
        <!-- <div class="row justify-content-center"> -->
            <!-- <div class="col-sm-5 align-self-center"> -->
            <!--     {{ playlist['description']['no_tracks'] }} songs -->
            <!-- </div> -->
        <!-- </div> -->
    </div>


    <div id="numb{{ numb }}" class="collapse">
        <div class="card-body">
            <!-- INSERT playlist analytics here -->
            <div class="container mb-4">
                <div class="row">
                    <div class="col-xs-3 m-1">
                        <div class="card bg-primary text-white">
                            <div class="card-body bg-primary">
                                <h3 class="">{{ playlist['description']['avg_year'] }}</h4>
                                <p class="mb-0">average release year</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-3 m-1">
                        <div class="card bg-primary text-white">
                            <div class="card-body bg-primary">
                                <h3 class="">{{ playlist['description']['avg_energy'] }}</h4>
                                <p class="mb-0">Energy level</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-3 m-1">
                        <div class="card bg-secondary text-white">
                            <div class="card-body bg-secondary">
                                <h3 class="">{{ playlist['description']['no_tracks'] }}</h4>
                                <p class="mb-0">songs in playlist</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-3 m-1">
                        <div class="card bg-success text-white">
                            <div class="card-body bg-success">
                                <h3 class="">{{ playlist['description']['avg_tempo'] }}</h4>
                                <p class="mb-0">Avg BPM</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-3 m-1">
                        <div class="card bg-success text-white">
                            <div class="card-body bg-success">
                                <h3 class="">{{ playlist['description']['avg_pop'] }}/10</h4>
                                <p class="mb-0">Song popularity</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center">
                <ul class="list-group border rounded" style="max-height:600px; overflow:auto;">
                    {% for song in playlist['songs'] %}
                    <li class="list-group-item">
                        <div class="row justify-content-start">
                            <div class = "col-xs-3 align-self-center">
                                <audio src="{{ song['preview_url'] }}" id="{{ song['preview_url'] }}" preload="none"
                                    onplay="pauseOthers(this);"></audio>
                                <i class="fas fa-volume-up" id="{{ song['preview_url'] }}-btn"
                                    onclick="playPause('{{ song['preview_url'] }}', this)" aria-hidden="true"
                                    style="cursor:pointer;"></i>
                            </div>
                            <div class="col-xs-3 p-1">
                                <img src="{{ song['img'] }}" alt="Playlist Image" class="rounded img-fluid"
                                    style="width: 30px;height: 30px;">
                            </div>
                            <div class="col-xs-6 p-1 text-dark text-left" style="overflow: hidden; white-space:nowrap; text-overflow:ellipsis; width:35vw;">
                                {{ song['track_name'] }} - {{ song['artist_name']}}
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endfor %}



<script>
    $('[data-toggle="buttons"] .btn').on('click', function () {
        // toggle style
        $(this).toggleClass('btn-grey active');
        // toggle checkbox
        var $chk = $(this).find('[type=checkbox]');
        $chk.prop('checked', !$chk.prop('checked'));
        return false;
    });

    /*$('form').on('submit', function(e) {
        // watch form values
        $('#formValues').html(($('form').serialize()));
        e.preventDefault();
    }); */
</script>

{% endblock %}
